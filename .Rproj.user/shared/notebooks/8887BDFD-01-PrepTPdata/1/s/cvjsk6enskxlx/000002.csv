"0","dbdata<-dbdata %>% "
"0","    mutate(PlotSpacing=ifelse(programName!=""IITA"",1,"
"0","                              ifelse(studyYear<2013,1,"
"0","                              ifelse(TrialType %in% c(""CET"",""GeneticGain"",""ExpCET""),1,0.8))))"
"0","maxNOHAV_byStudy<-dbdata %>% "
"0","  group_by(programName,locationName,studyYear,studyName,studyDesign) %>% "
"0","  summarize(MaxNOHAV=max(NOHAV, na.rm=T)) %>% "
"0","  ungroup() %>% "
"0","  mutate(MaxNOHAV=ifelse(MaxNOHAV==""-Inf"",NA,MaxNOHAV))"
"0",""
"0","dbdata<-left_join(dbdata,maxNOHAV_byStudy) %>% "
"0","  mutate(logFYLD=log(RTWT/(MaxNOHAV*PlotSpacing)*10),"
"0","         logTOPYLD=log(SHTWT/(MaxNOHAV*PlotSpacing)*10),"
"0","         PropNOHAV=NOHAV/MaxNOHAV) "
